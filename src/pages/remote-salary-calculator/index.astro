---
import Layout from '../../layouts/Layout.astro';
import colData from '../../data/col-indices.json';

const metaTitle = `Remote Salary Calculator: Digital Nomad Purchasing Power`;
const metaDescription = `Calculate how much your remote salary is worth when you move abroad. Compare purchasing power as a digital nomad to find where you can live best.`;
const canonicalUrl = `https://econified.com/remote-salary-calculator/`;

const locations = Object.entries(colData).map(([id, data]) => ({ id, ...data as any }));
locations.sort((a, b) => a.name.localeCompare(b.name));

const schemaData = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Remote Salary Parity Calculator",
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "Web"
};

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "name": "Home",
    "item": "https://econified.com/"
  },{
    "@type": "ListItem",
    "position": 2,
    "name": "Global Salary",
    "item": "https://econified.com/global-salary/"
  },{
    "@type": "ListItem",
    "position": 3,
    "name": "Remote"
  }]
};

const currentYear = new Date().getFullYear();
---

<Layout title={metaTitle} description={metaDescription} canonicalUrl={canonicalUrl}>
  <script type="application/ld+json" set:html={JSON.stringify(schemaData)} />
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
  <script data-domain="econified.com" src="https://plausible.io/js/script.js" defer></script>
  
  <main class="container">
    <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 1rem;">
      <nav class="breadcrumb" style="font-size: 0.875rem; color: var(--text-secondary);">
        <a href="/" style="color: inherit;">Home</a> &rsaquo; 
        <a href="/global-salary/" style="color: inherit;">Global Salary</a> &rsaquo; Remote
      </nav>
      <span style="font-size: 0.85rem; color: var(--success-color, #22c55e); font-weight: 500;">
        <span aria-hidden="true">&#10003;</span> Updated for {currentYear}
      </span>
    </div>
    
    <div class="tool-header" style="margin-bottom: 1.5rem;">
      <h1 style="margin-bottom: 0.5rem; font-size: 2.2rem;">Remote Salary Calculator</h1>
      <p class="direct-answer" id="directAnswer" style="font-size: 1.1rem; line-height: 1.6; margin-top: 0.5rem; border-left: 3px solid var(--primary); padding-left: 1rem; color: var(--text-secondary);">
        A remote salary of <strong style="color:var(--text-primary)">$100,000</strong> from <strong style="color:var(--text-primary)">New York City</strong> provides approximately <strong style="color:var(--text-primary)">155% greater</strong> purchasing power when living in <strong style="color:var(--text-primary)">Lisbon</strong>.
      </p>
    </div>

    <div class="parity-container" style="display: grid; grid-template-columns: 1fr; gap: 2rem; align-items: start;">
        
        <!-- Calculator Inputs -->
        <div class="glass-panel" id="calculator-app" aria-live="polite" style="position: sticky; top: 100px;">
          <form id="parity-form">
            <div class="input-group">
                <label for="originSalary">Current Remote Salary</label>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="number" id="originSalary" value="100000" min="0" step="1000" style="flex: 1;" required>
                    <select id="currency" style="width: 100px; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--surface-border); background: var(--surface); color: var(--text-primary);">
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="CAD">CAD</option>
                        <option value="AUD">AUD</option>
                        <option value="NOK">NOK</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label for="originLocation">Tax Residency (Home)</label>
                 <select id="originLocation" required style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--surface-border); background: var(--surface); color: var(--text-primary);">
                    {locations.map(loc => <option value={loc.id} selected={loc.id==='NYC'}>{loc.name}</option>)}
                </select>
            </div>

            <div class="input-group">
                <label for="destLocation">Relocating To</label>
                <select id="destLocation" required style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--surface-border); background: var(--surface); color: var(--text-primary);">
                    {locations.map(loc => <option value={loc.id} selected={loc.id==='Lisbon'}>{loc.name}</option>)}
                </select>
            </div>

            <div class="input-group" style="margin-top: 1rem; padding: 1rem; background: rgba(30,41,59,0.5); border-radius: 8px;">
                <label style="margin-bottom: 0.5rem; display: block; font-weight: 600;">Employment Type</label>
                <div style="display: flex; gap: 1rem;">
                    <label style="display: inline-flex; align-items: center; gap: 0.5rem; font-weight: normal; cursor: pointer; opacity: 0.7;">
                        <input type="radio" name="empType" value="local"> Local Hire
                    </label>
                    <label style="display: inline-flex; align-items: center; gap: 0.5rem; font-weight: normal; cursor: pointer;">
                        <input type="radio" name="empType" value="remote" checked> Remote (Digital Nomad)
                    </label>
                </div>
                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">
                    Remote computes pure purchasing power assuming home taxes. Local computes required gross salary after local taxes.
                </div>
            </div>

            <div class="input-group" style="margin-top: 1.5rem;">
                <label for="lifestyleSlider" style="display: flex; justify-content: space-between;">
                    <span>Lifestyle Expectation</span>
                    <span id="lifestyleLabel" style="color: var(--primary-light); font-weight: bold;">Comfortable</span>
                </label>
                <input type="range" id="lifestyleSlider" min="0.8" max="1.5" step="0.1" value="1.2" style="width: 100%; margin-top: 0.5rem;">
                <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
                    <span>Budget</span>
                    <span>Average</span>
                    <span>Comfortable</span>
                    <span>Premium</span>
                </div>
            </div>
          </form>
        </div>

        <!-- Results Dashboard -->
        <div class="results-dashboard" style="display: flex; flex-direction: column; gap: 1.5rem;">
            
            <div class="glass-panel" style="background: linear-gradient(145deg, rgba(30,41,59,0.8), rgba(15,23,42,0.9)); border-color: var(--primary-light);">
                <h2 style="font-size: 1.1rem; color: var(--text-secondary); margin-top: 0; margin-bottom: 0.5rem;" id="dashboardH2">Salary Comparison: Required Equivalent</h2>
                <div id="headlineResult" style="font-size: 2.5rem; font-weight: 800; color: var(--text-primary); margin-bottom: 0.5rem;">-</div>
                <p id="headlineSubtext" style="color: var(--text-secondary); margin: 0; font-size: 0.95rem;">-</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <div class="glass-panel" style="padding: 1rem;">
                    <div style="font-size: 0.85rem; color: var(--text-secondary);">Purchasing Power</div>
                    <div id="ppResult" style="font-size: 1.5rem; font-weight: 700; color: var(--accent-light); margin-top: 0.25rem;">-</div>
                </div>
                <div class="glass-panel" style="padding: 1rem;">
                    <div style="font-size: 0.85rem; color: var(--text-secondary);">Estimated Tax (Home)</div>
                    <div id="taxResult" style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary); margin-top: 0.25rem;">-</div>
                </div>
            </div>

            <!-- AI Insight Block -->
            <div class="glass-panel" style="border-left: 4px solid var(--primary);">
                <h3 style="margin-top: 0; font-size: 1.1rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span aria-hidden="true">âœ¨</span> Remote Nomad Insights
                </h3>
                <ul id="aiInsights" style="margin: 0; padding-left: 1.5rem; color: var(--text-secondary); line-height: 1.6;">
                    <li>Awaiting calculation...</li>
                </ul>
            </div>

        </div>
    </div>
  </main>
  
  <script>
    import colDataRaw from '../../data/col-indices.json';
    const colData: Record<string, any> = colDataRaw;

    const form = document.getElementById('parity-form');
    if (form) {
        const salaryIn = document.getElementById('originSalary') as HTMLInputElement;
        const currIn = document.getElementById('currency') as HTMLSelectElement;
        const origIn = document.getElementById('originLocation') as HTMLSelectElement;
        const destIn = document.getElementById('destLocation') as HTMLSelectElement;
        const sliderIn = document.getElementById('lifestyleSlider') as HTMLInputElement;
        const lifestyleLabel = document.getElementById('lifestyleLabel');

        const radios = Array.from(document.querySelectorAll('input[name="empType"]')) as HTMLInputElement[];
        
        function updateLifestyleLabel(val: number) {
            if (!lifestyleLabel) return;
            if (val <= 0.8) lifestyleLabel.textContent = 'Budget';
            else if (val <= 1.0) lifestyleLabel.textContent = 'Average';
            else if (val <= 1.2) lifestyleLabel.textContent = 'Comfortable';
            else lifestyleLabel.textContent = 'Premium';
        }

        function calculate() {
            const salary = parseFloat(salaryIn.value) || 0;
            const originId = origIn.value;
            const destId = destIn.value;
            const lifestyleMult = parseFloat(sliderIn.value) || 1.0;
            const empType = radios.find(r => r.checked)?.value || 'remote';
            const localCurrency = currIn.value;
            
            updateLifestyleLabel(lifestyleMult);

            if (!originId || !destId || !colData[originId] || !colData[destId] || salary <= 0 || !window.Currency) return;

            const origin = colData[originId];
            const dest = colData[destId];

            // 1. Convert input salary from LOCAL currency to USD for calculations
            const salaryUSD = window.Currency.convertToUSD(salary, localCurrency);

            // Core Math
            const colRatio = dest.col_index / origin.col_index;
            let adjustedGrossUSD = 0;
            
            const originNetUSD = salaryUSD * (1 - origin.tax_rate_est);
            let targetNetUSD = originNetUSD * colRatio * lifestyleMult;

            if (empType === 'local') {
                adjustedGrossUSD = targetNetUSD / (1 - dest.tax_rate_est);
            } else {
                adjustedGrossUSD = targetNetUSD / (1 - origin.tax_rate_est);
            }

            // Update UI
            const adjustedGrossSelected = window.Currency.convertFromUSD(adjustedGrossUSD, localCurrency);
            
            const hl = document.getElementById('headlineResult');
            const hsl = document.getElementById('headlineSubtext');
            const dh2 = document.getElementById('dashboardH2');
            
            if (hl) hl.textContent = window.Currency.format(adjustedGrossSelected, localCurrency);
            if (hsl) hsl.textContent = `To maintain this lifestyle living as a nomad in ${dest.name}, sourcing from ${origin.name}.`;
            if (dh2) dh2.textContent = `Salary Comparison: ${origin.name} vs ${dest.name}`;

            const ppScore = ((origin.col_index / dest.col_index) * 100 - 100);
            const ppEl = document.getElementById('ppResult');
            if (ppEl) {
                if (ppScore > 0) {
                     ppEl.textContent = `+${ppScore.toFixed(0)}% more power`;
                     ppEl.style.color = 'var(--success-color, #22c55e)';
                } else if (ppScore < 0) {
                     ppEl.textContent = `${ppScore.toFixed(0)}% less power`;
                     ppEl.style.color = 'var(--error-color, #ef4444)';
                } else {
                     ppEl.textContent = `Equal`;
                     ppEl.style.color = 'var(--text-secondary)';
                }
            }

            const taxEl = document.getElementById('taxResult');
            if (taxEl) {
                if (empType === 'local') {
                    taxEl.textContent = `${(dest.tax_rate_est * 100).toFixed(0)}% (Local)`;
                } else {
                    taxEl.textContent = `${(origin.tax_rate_est * 100).toFixed(0)}% (Home)`;
                }
            }

            // Update Direct Answer Block
            const daEl = document.getElementById('directAnswer');
            if (daEl) {
                const diffTxt = ppScore > 0 ? `${ppScore.toFixed(0)}% greater` : `${Math.abs(ppScore).toFixed(0)}% lower`;
                const formattedSalary = window.Currency.format(salary, localCurrency);
                const answerHTML = `A remote salary of <strong style="color:var(--text-primary)">${formattedSalary}</strong> from <strong style="color:var(--text-primary)">${origin.name}</strong> provides approximately <strong style="color:var(--text-primary)">${diffTxt}</strong> purchasing power when living in <strong style="color:var(--text-primary)">${dest.name}</strong>.`;
                daEl.innerHTML = answerHTML;
            }

            // Generate Insights
            const insights = document.getElementById('aiInsights');
            if (insights) {
                let html = '';
                
                if (dest.rent_index < origin.rent_index) {
                    const savings = ((1 - (dest.rent_index / origin.rent_index)) * 100).toFixed(0);
                    html += `<li><strong>Housing advantage:</strong> Moving here remotely reduces average rent by roughly ${savings}%, leaving significantly more disposable income.</li>`;
                } else {
                    const increase = (((dest.rent_index / origin.rent_index) - 1) * 100).toFixed(0);
                    html += `<li><strong>Housing pressure:</strong> Expect to pay ~${increase}% more for housing as a remote worker in ${dest.name}.</li>`;
                }

                if (empType === 'remote') {
                    html += `<li><strong>Geo-arbitrage:</strong> You are executing geo-arbitrage by keeping your home income while taking advantage of local pricing in ${dest.name}. Note that local "Digital Nomad" visa taxes aren't factored here automatically unless specified.</li>`;
                }

                if (lifestyleMult > 1.0) {
                    html += `<li><strong>Lifestyle upgrade:</strong> You've elected a premium lifestyle tier, inflating your required target salary by ${( (lifestyleMult-1)*100 ).toFixed(0)}% above baseline equivalence.</li>`;
                }
                
                insights.innerHTML = html;
            }
        }

        form.addEventListener('input', calculate);

        // SYNC Global to Local: If global changes, update local selector
        window.addEventListener('currencyChanged', (e: any) => {
            if (currIn) {
                currIn.value = e.detail.currency;
                calculate();
            }
        });

        // Initial setup
        function initSync() {
            if (window.Currency) {
                currIn.value = window.Currency.get();
                calculate();
            }
        }

        // Wait for currency engine to be ready
        window.addEventListener('currencyReady', initSync);
        
        // Also try immediately (in case it's already loaded)
        initSync();

        // Specific CSS for media query
        const style = document.createElement('style');
        style.innerHTML = `
            @media (min-width: 900px) {
                .parity-container { grid-template-columns: 350px 1fr !important; }
            }
        `;
        document.head.appendChild(style);
    }
  </script>
</Layout>
